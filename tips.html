<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-12-22 Fri 13:38 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Some Tips</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Nan Jun Jie" />
<link rel="stylesheet" type="text/css" href="css/org.css" />
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a> | 
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Some Tips</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3dbe3e4">Ssh</a>
<ul>
<li><a href="#orgf78dd43">Using SSH Multiplexing</a></li>
</ul>
</li>
<li><a href="#orgb17daf4">QEMU</a>
<ul>
<li><a href="#orgf324ee3">which nic models qemu supports?</a></li>
<li><a href="#orgfe1d78e">Quit qemu `C-A C`.</a></li>
</ul>
</li>
<li><a href="#org06f6745">Ncat</a>
<ul>
<li><a href="#org82af2c1">Install</a></li>
<li><a href="#org2c506fe">Transfer Single FIle</a></li>
<li><a href="#orgf05fee4">Transfer Multiple Files</a></li>
<li><a href="#orga2a171b">Proxy As A Http Proxy Server</a></li>
<li><a href="#orgd80dda2">Proxy Over Ssh</a></li>
<li><a href="#org766b43a">Proxy Ssh</a></li>
<li><a href="#orgf4a22de">Proxy Ansible</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org3dbe3e4" class="outline-2">
<h2 id="org3dbe3e4">Ssh</h2>
<div class="outline-text-2" id="text-org3dbe3e4">
</div>
<div id="outline-container-orgf78dd43" class="outline-3">
<h3 id="orgf78dd43"><a href="https://blog.scottlowe.org/2015/12/11/using-ssh-multiplexing/">Using SSH Multiplexing</a></h3>
<div class="outline-text-3" id="text-orgf78dd43">
<pre class="example">
ControlMaster auto
ControlPath ~/.ssh/sockets/%r@%h-%p
ControlPersist 600
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb17daf4" class="outline-2">
<h2 id="orgb17daf4">QEMU</h2>
<div class="outline-text-2" id="text-orgb17daf4">
</div>
<div id="outline-container-orgf324ee3" class="outline-3">
<h3 id="orgf324ee3">which nic models qemu supports?</h3>
<div class="outline-text-3" id="text-orgf324ee3">
<div class="org-src-container">
<pre class="src src-sh">qemu-system-x86_64 -net nic,<span class="org-variable-name">model</span>=?
<span class="org-comment-delimiter">#</span><span class="org-comment">=&gt;</span>
qemu: Supported NIC models: ne2k_pci,i82551,i82557b,i82559er,rtl8139,e1000,pcnet,virtio
</pre>
</div>
</div>
</div>
<div id="outline-container-orgfe1d78e" class="outline-3">
<h3 id="orgfe1d78e">Quit qemu `C-A C`.</h3>
</div>
</div>

<div id="outline-container-org06f6745" class="outline-2">
<h2 id="org06f6745">Ncat</h2>
<div class="outline-text-2" id="text-org06f6745">
<p>
<a href="https://nmap.org/ncat/">Ncat</a> is a general-purpose command-line tool for reading, writing,
redirecting, and encrypting data across a network. It is along with
<a href="https://nmap.org/">nmap</a>, but not so famous.
</p>
</div>

<div id="outline-container-org82af2c1" class="outline-3">
<h3 id="org82af2c1">Install</h3>
<div class="outline-text-3" id="text-org82af2c1">
<p>
To install ncat just install nmap, Ubuntu:
</p>
<pre class="example">
apt-get install nmap
</pre>

<p>
Mac:
</p>

<pre class="example">
brew install nmap
</pre>

<p>
Here some tips from me.
</p>
</div>
</div>

<div id="outline-container-org2c506fe" class="outline-3">
<h3 id="org2c506fe">Transfer Single FIle</h3>
<div class="outline-text-3" id="text-org2c506fe">
<p>
Transfer single file:
</p>

<pre class="example">
# on machine A
ncat -p 80 -l --send-only &lt; file
# on machine B
ncat &lt;machine A ip&gt; 80 --recv-only &gt; file
</pre>
</div>
</div>

<div id="outline-container-orgf05fee4" class="outline-3">
<h3 id="orgf05fee4">Transfer Multiple Files</h3>
<div class="outline-text-3" id="text-orgf05fee4">
<p>
Transfer multiple files:
</p>

<pre class="example">
# on machine A
for file in *.deb; do
    echo $file | ncat -p 80 -l --send-only
    ncat -p 80 -l --send-only &lt; $file
done
# on machine B
while true; do
    file=$(ncat &lt;machine A ip&gt; 80 --recv-only) || break
    echo $file
    ncat &lt;machine A ip&gt; 80 --recv-only &gt; $file
done
</pre>
</div>
</div>

<div id="outline-container-orga2a171b" class="outline-3">
<h3 id="orga2a171b">Proxy As A Http Proxy Server</h3>
<div class="outline-text-3" id="text-orga2a171b">
<p>
Ncat can act as a http proxy server, which 
</p>

<p>
Run:
</p>

<pre class="example">
ncat -l -p 8888 --proxy-type http --allow 127.0.0.1
</pre>

<p>
Test it(on the machine running ncat):
</p>

<pre class="example">
export https_proxy=http://127.0.0.1:8888
curl https://www.google.com
</pre>
</div>
</div>

<div id="outline-container-orgd80dda2" class="outline-3">
<h3 id="orgd80dda2">Proxy Over Ssh</h3>
<div class="outline-text-3" id="text-orgd80dda2">
<p>
Let's say you are living in China, right behind the GFW. You have
Ncat in http proxy mode on a machine outside. Now you can jump over
the wall via ssh:
</p>

<pre class="example">
ssh -L 127.0.0.1:8888:127.0.0.1:8888 &lt;your machine outside the wall&gt;
</pre>

<p>
Test it again(on the machine running <code>ssh -L</code>):
</p>

<pre class="example">
export http_proxy=http://127.0.0.1:8888
curl http://www.google.com
</pre>

<p>
Http request will go through your local port 8888, encrypted and
jump over the wall, go to your target machine local port 8888, via
ncat to access the world. It's safe, simple, stable and fast.
</p>
</div>
</div>

<div id="outline-container-org766b43a" class="outline-3">
<h3 id="org766b43a">Proxy Ssh</h3>
<div class="outline-text-3" id="text-org766b43a">
<p>
Ncat http proxy mode support <code>CONNECT</code> method also. So it can be
used as a ssh proxy:
</p>

<pre class="example">
ssh -o "ProxyCommand=ncat --proxy 127.0.0.1:8888 %h %p" user@host
</pre>

<p>
Ssh traffic will go to your local port 8888, ssh will forward it to
your jumpbox, which ncat is running there, to visit all the machines
running behind the jumpbox. In this way, you can keep your ssh keys
in your local, no need to copy anywhere in order to access your
machines.
</p>

<p>
You can put it to your <code>~/.ssh/config</code>:
</p>

<pre class="example">
Host: host
Hostname: host
ProxyCommand: ncat --proxy 127.0.0.1:8888 %h %p
</pre>
</div>
</div>

<div id="outline-container-orgf4a22de" class="outline-3">
<h3 id="orgf4a22de">Proxy Ansible</h3>
<div class="outline-text-3" id="text-orgf4a22de">
<p>
You can run ansible with below configuration in your inventory:
</p>

<pre class="example">
[all:vars]
ansible_ssh_common_args='-o ProxyCommand="ncat --proxy 127.0.0.1:8888 %h %p"'
</pre>
</div>
</div>
</div>
</div>
</body>
</html>
