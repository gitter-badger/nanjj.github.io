<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-11-04 Sat 00:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ncat Tips</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Nan Jun Jie" />
<link rel="stylesheet" type="text/css" href="css/org.css" />
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a> | 
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Ncat Tips</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc56f254">Transfer Files</a></li>
<li><a href="#org92f01a1">Proxy The World</a></li>
</ul>
</div>
</div>
<p>
<a href="https://nmap.org/ncat/">Ncat</a> is a general-purpose command-line tool for reading, writing,
redirecting, and encrypting data across a network. It is along with
<a href="https://nmap.org/">nmap</a>, but not so famous.
</p>

<p>
To install ncat just install nmap, Ubuntu:
</p>
<pre class="example">
apt-get install nmap
</pre>

<p>
Mac:
</p>

<pre class="example">
brew install nmap
</pre>

<p>
Here some tips from me.
</p>

<div id="outline-container-orgc56f254" class="outline-2">
<h2 id="orgc56f254">Transfer Files</h2>
<div class="outline-text-2" id="text-orgc56f254">
<p>
Transfer single file:
</p>

<pre class="example">
# on machine A
ncat -p 80 -l --send-only &lt; file
# on machine B
ncat &lt;machine A ip&gt; 80 --recv-only &gt; file
</pre>

<p>
Transfer multiple files:
</p>

<pre class="example">
# on machine A
for file in *.deb; do
    echo $file | ncat -p 80 -l --send-only
    ncat -p 80 -l --send-only &lt; $file
done
# on machine B
while true; do
    file=$(ncat &lt;machine A ip&gt; 80 --recv-only) || break
    echo $file
    ncat &lt;machine A ip&gt; 80 --recv-only &gt; $file
done
</pre>
</div>
</div>

<div id="outline-container-org92f01a1" class="outline-2">
<h2 id="org92f01a1">Proxy The World</h2>
<div class="outline-text-2" id="text-org92f01a1">
<p>
Ncat can act as a http proxy server:
</p>

<pre class="example">
ncat -l -p 8888 --proxy-type http --allow 127.0.0.1
</pre>

<p>
Test it(on the machine running ncat):
</p>

<pre class="example">
export https_proxy=http://127.0.0.1:8888
curl https://www.google.com
</pre>

<p>
Let's say you are living in China, right behind the GFW. You have
Ncat in http proxy mode on a machine outside. Now you can jump over
the wall via ssh:
</p>

<pre class="example">
ssh -L 127.0.0.1:8888:127.0.0.1:8888 &lt;your machine outside the wall&gt;
</pre>

<p>
Test it again(on the machine running <code>ssh -L</code>):
</p>

<pre class="example">
export http_proxy=http://127.0.0.1:8888
curl http://www.google.com
</pre>

<p>
Http request will go through your local port 8888, encrypted and
jump over the wall, go to your target machine local port 8888, via
ncat to access the world. It's safe, simple, stable and fast.
</p>

<p>
Ncat http proxy mode support <code>CONNECT</code> method also. So it can be
used as a ssh proxy:
</p>

<pre class="example">
ssh -o "ProxyCommand=ncat --proxy 127.0.0.1:8888 %h %p" user@host
</pre>

<p>
Ssh traffic will go to your local port 8888, ssh will forward it to
your jumpbox, which ncat is running there, to visit all the machines
running behind the jumpbox. In this way, you can keep your ssh keys
in your local, no need to copy anywhere in order to access your
machines.
</p>

<p>
You can run ansible with below configuration in your inventory:
</p>

<pre class="example">
[all:vars]
ansible_ssh_common_args='-o ProxyCommand="ncat --proxy 127.0.0.1:8888 %h %p"'
</pre>
</div>
</div>
</div>
</body>
</html>
