<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2017-11-20 Mon 21:49 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ncat Tips</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Nan Jun Jie" />
<link rel="stylesheet" type="text/css" href="css/org.css" />
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="index.html"> UP </a> | 
 <a accesskey="H" href="index.html"> HOME </a>
</div><div id="content">
<h1 class="title">Ncat Tips</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orga43f9f9">Install</a></li>
<li><a href="#org54463a8">Transfer Files</a>
<ul>
<li><a href="#org584b016">Single File</a></li>
<li><a href="#org88064b5">Multiple Files</a></li>
</ul>
</li>
<li><a href="#orgcc009ff">Proxy The World</a>
<ul>
<li><a href="#orgfae0072">As A Http Proxy Server</a></li>
<li><a href="#org4ef72ef">Proxy Over Ssh</a></li>
<li><a href="#org678a5aa">Proxy Ssh</a></li>
<li><a href="#org7d67006">Proxy Ansible</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
<a href="https://nmap.org/ncat/">Ncat</a> is a general-purpose command-line tool for reading, writing,
redirecting, and encrypting data across a network. It is along with
<a href="https://nmap.org/">nmap</a>, but not so famous.
</p>

<div id="outline-container-orga43f9f9" class="outline-2">
<h2 id="orga43f9f9">Install</h2>
<div class="outline-text-2" id="text-orga43f9f9">
<p>
To install ncat just install nmap, Ubuntu:
</p>
<pre class="example">
apt-get install nmap
</pre>

<p>
Mac:
</p>

<pre class="example">
brew install nmap
</pre>

<p>
Here some tips from me.
</p>
</div>
</div>

<div id="outline-container-org54463a8" class="outline-2">
<h2 id="org54463a8">Transfer Files</h2>
<div class="outline-text-2" id="text-org54463a8">
</div>
<div id="outline-container-org584b016" class="outline-3">
<h3 id="org584b016">Single File</h3>
<div class="outline-text-3" id="text-org584b016">
<p>
Transfer single file:
</p>

<pre class="example">
# on machine A
ncat -p 80 -l --send-only &lt; file
# on machine B
ncat &lt;machine A ip&gt; 80 --recv-only &gt; file
</pre>
</div>
</div>

<div id="outline-container-org88064b5" class="outline-3">
<h3 id="org88064b5">Multiple Files</h3>
<div class="outline-text-3" id="text-org88064b5">
<p>
Transfer multiple files:
</p>

<pre class="example">
# on machine A
for file in *.deb; do
    echo $file | ncat -p 80 -l --send-only
    ncat -p 80 -l --send-only &lt; $file
done
# on machine B
while true; do
    file=$(ncat &lt;machine A ip&gt; 80 --recv-only) || break
    echo $file
    ncat &lt;machine A ip&gt; 80 --recv-only &gt; $file
done
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcc009ff" class="outline-2">
<h2 id="orgcc009ff">Proxy The World</h2>
<div class="outline-text-2" id="text-orgcc009ff">
<p>
Ncat can act as a http proxy server, which 
</p>
</div>

<div id="outline-container-orgfae0072" class="outline-3">
<h3 id="orgfae0072">As A Http Proxy Server</h3>
<div class="outline-text-3" id="text-orgfae0072">
<p>
Run:
</p>

<pre class="example">
ncat -l -p 8888 --proxy-type http --allow 127.0.0.1
</pre>

<p>
Test it(on the machine running ncat):
</p>

<pre class="example">
export https_proxy=http://127.0.0.1:8888
curl https://www.google.com
</pre>
</div>
</div>

<div id="outline-container-org4ef72ef" class="outline-3">
<h3 id="org4ef72ef">Proxy Over Ssh</h3>
<div class="outline-text-3" id="text-org4ef72ef">
<p>
Let's say you are living in China, right behind the GFW. You have
Ncat in http proxy mode on a machine outside. Now you can jump over
the wall via ssh:
</p>

<pre class="example">
ssh -L 127.0.0.1:8888:127.0.0.1:8888 &lt;your machine outside the wall&gt;
</pre>

<p>
Test it again(on the machine running <code>ssh -L</code>):
</p>

<pre class="example">
export http_proxy=http://127.0.0.1:8888
curl http://www.google.com
</pre>

<p>
Http request will go through your local port 8888, encrypted and
jump over the wall, go to your target machine local port 8888, via
ncat to access the world. It's safe, simple, stable and fast.
</p>
</div>
</div>

<div id="outline-container-org678a5aa" class="outline-3">
<h3 id="org678a5aa">Proxy Ssh</h3>
<div class="outline-text-3" id="text-org678a5aa">
<p>
Ncat http proxy mode support <code>CONNECT</code> method also. So it can be
used as a ssh proxy:
</p>

<pre class="example">
ssh -o "ProxyCommand=ncat --proxy 127.0.0.1:8888 %h %p" user@host
</pre>

<p>
Ssh traffic will go to your local port 8888, ssh will forward it to
your jumpbox, which ncat is running there, to visit all the machines
running behind the jumpbox. In this way, you can keep your ssh keys
in your local, no need to copy anywhere in order to access your
machines.
</p>

<p>
You can put it to your <code>~/.ssh/config</code>:
</p>

<pre class="example">
Host: host
Hostname: host
ProxyCommand: ncat --proxy 127.0.0.1:8888 %h %p
</pre>
</div>
</div>

<div id="outline-container-org7d67006" class="outline-3">
<h3 id="org7d67006">Proxy Ansible</h3>
<div class="outline-text-3" id="text-org7d67006">
<p>
You can run ansible with below configuration in your inventory:
</p>

<pre class="example">
[all:vars]
ansible_ssh_common_args='-o ProxyCommand="ncat --proxy 127.0.0.1:8888 %h %p"'
</pre>
</div>
</div>
</div>
</div>
</body>
</html>
